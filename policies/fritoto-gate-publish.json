{
  "common": {
    "context": {
      "buildPoint": {
        "value": "git+ssh://github.com/carabiner-dev/demo-slsa-e2e"
      },
      "buildType": {
        "value": "https://github.com/Attestations/GitHubActionsWorkflow@v1"
      },
      "builderId": {
        "value": "https://github.com/carabiner-dev/demo-slsa-e2e/.github/workflows/release.yaml"
      },
      "vsa.resourceUri": {
        "type": "string"
      }
    },
    "identities": [
      {
        "sigstore": {
          "identity": "https://github.com/[-a-z]+/demo-slsa-e2e/.github/workflows/release.yaml@refs/tags/v.+",
          "issuer": "https://token.actions.githubusercontent.com",
          "mode": "regexp"
        }
      }
    ]
  },
  "id": "fritoto-gate-publish",
  "meta": {
    "description": "# fritoto-gate-publish\n\nEnsures the SLSA level of the built binaries and dependencies before publishing\nthe release artifacts.\n\n## Purpose\n\nThis PolicySet verifies the SLSA build attestation of each of the binaries and\nthe project's dependencies (builder and source) according to the SLSA spec.\n\nThis set has five policies. The first verify the build provenance of each binary.\n\nThe. next policy chains the build provenance to the build point commit and\nchecks its SLSA source attestations to verify it is SLSA Source Level 3. \n\nFinally, we verify the VSA capturing the SLSA Build verification results from the\nbuild image policy.\n\nThis policy generates the verification summaries (VSAs) that users will be able\nto use to check the binaries.\n",
    "enforce": "ON",
    "frameworks": [
      {
        "id": "SLSA",
        "name": "Supply-Chain Levels for Software Artifacts"
      }
    ],
    "origin": {
      "digest": {
        "sha256": "5f0a7492293107076e0b732e54223a6ec4641cd6a2ff51bff652ed50f1c4e704",
        "sha512": "22ce09021a82230fdcfaeb473b714dddbd424010d04a6576228e78a3a4eab50a2f25eac7d2e25f43e2270ddef11c6f02cbc0dbbebf00e4b53a129e839670b45c"
      },
      "name": "fritoto-gate-publish"
    }
  },
  "policies": [
    {
      "id": "slsa-builder-id",
      "meta": {
        "controls": [
          {
            "class": "BUILD",
            "framework": "SLSA",
            "id": "LEVEL_2"
          }
        ]
      },
      "source": {
        "location": {
          "uri": "git+https://github.com/carabiner-dev/policies#slsa/slsa-builder-id.json"
        }
      }
    },
    {
      "id": "slsa-build-type",
      "meta": {
        "controls": [
          {
            "class": "BUILD",
            "framework": "SLSA",
            "id": "LEVEL_2"
          }
        ]
      },
      "source": {
        "location": {
          "uri": "git+https://github.com/carabiner-dev/policies#slsa/slsa-build-type.json"
        }
      }
    },
    {
      "id": "slsa-build-point",
      "meta": {
        "controls": [
          {
            "class": "BUILD",
            "framework": "SLSA",
            "id": "LEVEL_2"
          }
        ]
      },
      "source": {
        "location": {
          "uri": "git+https://github.com/carabiner-dev/policies#slsa/slsa-build-point.json"
        }
      }
    },
    {
      "chain": [
        {
          "predicate": {
            "selector": "has(predicates[0].data.buildDefinition) ? (\nhas(predicates[0].data.buildDefinition.resolvedDependencies) ? (\n  predicates[0].data.buildDefinition.resolvedDependencies.map(dep, dep.uri.startsWith(context.buildPointRepo + '@'), dep)[0]\n) : '' \n) : ''",
            "type": "https://slsa.dev/provenance/v1"
          }
        }
      ],
      "context": {
        "buildPointRepo": {
          "default": "git+ssh://github.com/carabiner-dev/demo-slsa-e2e",
          "required": true,
          "type": "string"
        },
        "builderImage": {
          "default": "cgr.dev/chainguard/go",
          "required": true,
          "type": "string"
        }
      },
      "id": "slsa-source-level",
      "identities": [
        {
          "sigstore": {
            "identity": "https://github.com/slsa-framework/source-actions/.github/workflows/compute_slsa_source.yml@refs/heads/main",
            "issuer": "https://token.actions.githubusercontent.com"
          }
        }
      ],
      "meta": {
        "controls": [
          {
            "class": "SOURCE",
            "framework": "SLSA",
            "id": "3"
          }
        ],
        "enforce": "ON"
      },
      "source": {
        "location": {
          "uri": "git+https://github.com/carabiner-dev/policies#vsa/slsa-source-level3.json"
        }
      }
    },
    {
      "chain": [
        {
          "predicate": {
            "selector": "has(predicates[0].data.buildDefinition) ? (\nhas(predicates[0].data.buildDefinition.resolvedDependencies) ? (\n  predicates[0].data.buildDefinition.resolvedDependencies.map(dep, dep.uri.startsWith(context.builderImage + '@'), dep.uri)[0].substring(context.builderImage.size() + 1)\n) : '' \n) : ''",
            "type": "https://slsa.dev/provenance/v1"
          }
        }
      ],
      "context": {
        "builderImage": {
          "default": "cgr.dev/chainguard/go",
          "required": true,
          "type": "string"
        }
      },
      "id": "slsa-builder-image,",
      "identities": [
        {
          "sigstore": {
            "identity": "https://github.com/slsa-framework/source-actions/.github/workflows/compute_slsa_source.yml@refs/heads/main",
            "issuer": "https://token.actions.githubusercontent.com"
          }
        }
      ],
      "source": {
        "location": {
          "uri": "git+https://github.com/carabiner-dev/policies#vsa/slsa-build-level3.json"
        }
      }
    }
  ]
}
